/**
 * ============================================
 * 용신 알고리즘 가중치 설정 파일
 * ============================================
 * 
 * 이 파일에서 모든 가중치 수치를 관리합니다.
 * 가중치를 조절하면 오행 세력 계산 결과가 달라집니다.
 * 
 * 사용법: 각 상수의 값을 조절하면 됩니다.
 */

// ============================================
// 1. 위치별 가중치 (Positional Weights)
// ============================================

/**
 * 천간(天干) 위치별 가중치
 * - 천간은 드러난 기운으로, 지지보다 약함
 * - 통근(지지에 뿌리)이 없으면 허상에 불과
 */
export const CHEONGAN_WEIGHTS = {
  /** 년간 가중치 (조상궁, 가장 멀리) */
  YEAR: 1.0,
  
  /** 월간 가중치 (부모궁, 청년기) */
  MONTH: 1.2,
  
  /** 일간 가중치 - 기준점이므로 계산에서 제외 (0) */
  DAY: 0,
  
  /** 시간 가중치 (자녀궁, 말년) */
  HOUR: 1.1,
} as const;

/**
 * 지지(地支) 위치별 가중치
 * - 지지는 숨겨진 힘(뿌리)으로 천간보다 강함
 * - 월지가 가장 중요 (사령관, 계절 결정)
 */
export const JIJI_WEIGHTS = {
  /** 년지 가중치 (조상궁, 근본) */
  YEAR: 1.5,
  
  /** 월지 가중치 ⭐ 가장 중요! (제강, 계절, 40~50% 영향) */
  MONTH: 3.0,
  
  /** 일지 가중치 (배우자궁, 일간과 가장 가까움) */
  DAY: 1.8,
  
  /** 시지 가중치 (자녀궁, 말년 잠재력) */
  HOUR: 1.2,
} as const;


// ============================================
// 2. 지장간(地藏干) 배분율
// ============================================

/**
 * 지장간 일수 배분
 * - 각 지지 안에 숨어있는 천간들의 사령 일수
 * - 총 30일 기준
 * 
 * 구조: { 지지: { 천간: 일수 } }
 */
export const JIJANGGAN_DAYS = {
  // ========== 사왕지 (四旺地) ==========
  // 자오묘유 - 가장 순수한 기운
  
  /** 자(子) - 수(水) 왕지 */
  '子': { '壬': 10, '癸': 20 },
  
  /** 오(午) - 화(火) 왕지 (기토 섞임) */
  '午': { '丙': 10, '己': 9, '丁': 11 },
  
  /** 묘(卯) - 목(木) 왕지 */
  '卯': { '甲': 10, '乙': 20 },
  
  /** 유(酉) - 금(金) 왕지 */
  '酉': { '庚': 10, '辛': 20 },
  
  // ========== 사생지 (四生地) ==========
  // 인신사해 - 7일 + 7일 + 16일 = 30일
  
  /** 인(寅) - 목(木) 생지 */
  '寅': { '戊': 7, '丙': 7, '甲': 16 },
  
  /** 신(申) - 금(金) 생지 */
  '申': { '戊': 7, '壬': 7, '庚': 16 },
  
  /** 사(巳) - 화(火) 생지 */
  '巳': { '戊': 7, '庚': 7, '丙': 16 },
  
  /** 해(亥) - 수(水) 생지 */
  '亥': { '戊': 7, '甲': 7, '壬': 16 },
  
  // ========== 사고지 (四庫地) ==========
  // 진술축미 - 9일 + 3일 + 18일 = 30일
  
  /** 진(辰) - 토(土) 고지 (수의 창고) */
  '辰': { '乙': 9, '癸': 3, '戊': 18 },
  
  /** 술(戌) - 토(土) 고지 (화의 창고) */
  '戌': { '辛': 9, '丁': 3, '戊': 18 },
  
  /** 축(丑) - 토(土) 고지 (금의 창고) */
  '丑': { '癸': 9, '辛': 3, '己': 18 },
  
  /** 미(未) - 토(土) 고지 (목의 창고) */
  '未': { '丁': 9, '乙': 3, '己': 18 },
} as const;

/**
 * 지장간 오행 배분율 (%)
 * - 위의 일수를 백분율로 환산
 * - 총합 = 100%
 * 
 * 구조: { 지지: { 오행: 배분율 } }
 */
export const JIJANGGAN_PERCENT = {
  // 사왕지 (순수 기운)
  '子': { water: 100, wood: 0, fire: 0, earth: 0, metal: 0 },
  '午': { fire: 70, earth: 30, wood: 0, metal: 0, water: 0 },
  '卯': { wood: 100, fire: 0, earth: 0, metal: 0, water: 0 },
  '酉': { metal: 100, water: 0, wood: 0, fire: 0, earth: 0 },
  
  // 사생지 (여기 + 중기 + 본기)
  '寅': { wood: 53, fire: 23, earth: 24, metal: 0, water: 0 },  // 갑16 + 병7 + 무7
  '申': { metal: 53, water: 23, earth: 24, wood: 0, fire: 0 },  // 경16 + 임7 + 무7
  '巳': { fire: 53, metal: 23, earth: 24, wood: 0, water: 0 },  // 병16 + 경7 + 무7
  '亥': { water: 53, wood: 23, earth: 24, metal: 0, fire: 0 },  // 임16 + 갑7 + 무7
  
  // 사고지 (여기 + 중기 + 본기)
  '辰': { earth: 60, wood: 30, water: 10, fire: 0, metal: 0 },  // 무18 + 을9 + 계3
  '戌': { earth: 60, metal: 30, fire: 10, wood: 0, water: 0 },  // 무18 + 신9 + 정3
  '丑': { earth: 60, water: 30, metal: 10, wood: 0, fire: 0 },  // 기18 + 계9 + 신3
  '未': { earth: 60, fire: 30, wood: 10, metal: 0, water: 0 },  // 기18 + 정9 + 을3
} as const;


// ============================================
// 3. 합(合) 관련 가중치
// ============================================

/**
 * 합(合) 성립 시 보너스 배수
 */
export const HAB_MULTIPLIERS = {
  /** 삼합(三合) 완성 시 배수 (예: 인오술 화국) */
  SAMHAB_FULL: 2.0,
  
  /** 반합(半合) - 왕지 포함 */
  SAMHAB_HALF_WITH_KING: 1.5,
  
  /** 반합(半合) - 왕지 미포함 (가합) */
  SAMHAB_HALF_WITHOUT_KING: 0.3,
  
  /** 방합(方合) 완성 시 배수 (예: 인묘진 목국) */
  BANGHAB_FULL: 1.8,
  
  /** 방합 반합 */
  BANGHAB_HALF: 1.3,
  
  /** 육합(六合) */
  YUKHAB: 1.2,
  
  /** 천간합(天干合) 진합(합화 성공) 시 보너스 */
  CHEONGAN_HAB_TRUE: 1.5,
  
  /** 천간합 기반(합 실패, 묶임) 시 감산율 */
  CHEONGAN_HAB_TIE: 0.5,
} as const;


// ============================================
// 4. 충(沖) 관련 가중치
// ============================================

/**
 * 충(沖) 발생 시 감산율
 * - 충은 두 글자가 서로 파괴하는 작용
 * - 값은 남는 점수 비율 (0.6 = 40% 감소)
 */
export const CHUNG_REDUCTION = {
  /** 왕지충 (자오, 묘유) - 가장 격렬 */
  KING_CLASH: 0.6,
  
  /** 생지충 (인신, 사해) - 역동적 */
  BIRTH_CLASH: 0.7,
  
  /** 고지충 (진술, 축미) - 친구끼리의 충 */
  STORAGE_CLASH: 0.8,
  
  /** 개고(開庫) 효과 - 고지가 충 당할 때 지장간 점수 가산 */
  STORAGE_OPEN_BONUS: 1.2,
  
  /** 왕자충발 - 강한 쪽이 충으로 자극받아 점수 상승 */
  STRONG_STIMULATION: 1.1,
  
  /** 왕자충발 판정 기준 - 점수 차이 배수 */
  STRONG_THRESHOLD: 3.0,
} as const;


// ============================================
// 5. 월령 사령 가중치 (계절 영향)
// ============================================

/**
 * 월령(月令) 사령 가산 배수
 * - 월지 지장간 중 현재 사령하는 글자에 추가 가중치
 */
export const WOLRYEONG_SARYEONG = {
  /** 사령 글자(본기/중기/여기)에 추가 배수 */
  COMMANDING_BONUS: 1.5,
} as const;


// ============================================
// 6. 통근(通根) 관련 가중치
// ============================================

/**
 * 통근(通根) 계수
 * - 천간이 지지에 뿌리를 내리고 있는지 확인
 * - 통근 위치에 따라 계수가 달라짐
 */
export const TONGGEUN_COEFFICIENT = {
  /** 월지에 통근 (가장 강력) */
  MONTH: 1.5,
  
  /** 일지에 통근 */
  DAY: 1.3,
  
  /** 시지/연지에 통근 */
  HOUR_YEAR: 1.1,
  
  /** 통근처 전무 (무근) - 허약 */
  NO_ROOT: 0.7,
} as const;


// ============================================
// 7. 조후(調候) 긴급도 계수
// ============================================

/**
 * 조후(調候) 긴급도 - 월지별 설정
 * - 온도 지수와 조후 용신 가중치
 */
export const JOHU_URGENCY = {
  /** Critical (3.0) - 극한/극열 */
  CRITICAL: 3.0,
  
  /** High (2.0) - 한냉/건조 */
  HIGH: 2.0,
  
  /** Moderate (1.5) - 약간 조후 필요 */
  MODERATE: 1.5,
  
  /** Low (1.0) - 조후 불필요 */
  LOW: 1.0,
} as const;

/**
 * 월지별 조후 데이터
 * - temperature: 온도 지수 (-5 극한 ~ +5 극열)
 * - urgency: 긴급도 계수
 * - yongsin: 필요한 조후 용신 (우선순위 순)
 */
export const JOHU_BY_MONTH: {
  [key: string]: {
    temperature: number;
    urgency: number;
    yongsin: string[];
    description: string;
  };
} = {
  '子': { temperature: -5, urgency: JOHU_URGENCY.CRITICAL, yongsin: ['丙', '戊'], description: '동지, 혹한' },
  '丑': { temperature: -4, urgency: JOHU_URGENCY.HIGH, yongsin: ['丙', '甲'], description: '대한, 얼어붙은 땅' },
  '寅': { temperature: -2, urgency: JOHU_URGENCY.MODERATE, yongsin: ['丙'], description: '입춘, 초봄 한기' },
  '卯': { temperature: 0, urgency: JOHU_URGENCY.LOW, yongsin: [], description: '경칩, 양기 시생' },
  '辰': { temperature: 1, urgency: JOHU_URGENCY.LOW, yongsin: ['庚'], description: '청명, 봄 습함' },
  '巳': { temperature: 3, urgency: JOHU_URGENCY.MODERATE, yongsin: ['壬', '癸'], description: '입하, 초여름' },
  '午': { temperature: 5, urgency: JOHU_URGENCY.CRITICAL, yongsin: ['壬', '癸', '辛'], description: '하지, 염천' },
  '未': { temperature: 4, urgency: JOHU_URGENCY.HIGH, yongsin: ['癸', '甲'], description: '소서, 고온건조' },
  '申': { temperature: 1, urgency: JOHU_URGENCY.LOW, yongsin: [], description: '입추, 초가을' },
  '酉': { temperature: 0, urgency: JOHU_URGENCY.LOW, yongsin: [], description: '추분, 가을' },
  '戌': { temperature: -1, urgency: JOHU_URGENCY.MODERATE, yongsin: ['甲', '壬'], description: '한로, 늦가을 건조' },
  '亥': { temperature: -3, urgency: JOHU_URGENCY.HIGH, yongsin: ['丙', '戊'], description: '입동, 초겨울' },
};


// ============================================
// 8. 신강/신약 판정 임계값
// ============================================

/**
 * 신강/신약 판정을 위한 점수 기준
 * - 정규화된 점수 기준 (100점 만점 가정)
 */
export const STRENGTH_THRESHOLDS = {
  /** 태왕 (극신강) 기준 */
  EXTREME_STRONG: 50,
  
  /** 신강 기준 */
  STRONG: 10,
  
  /** 중화 범위 (이 안이면 중화) */
  NEUTRAL_MIN: -10,
  NEUTRAL_MAX: 10,
  
  /** 신약 기준 */
  WEAK: -10,
  
  /** 태약 (극신약) 기준 */
  EXTREME_WEAK: -40,
} as const;


// ============================================
// 9. 득령/득지/득세 점수
// ============================================

/**
 * 신강/신약 판정을 위한 가산점
 */
export const STRENGTH_SCORES = {
  /** 득령 (월지가 인성/비겁) */
  DEUKRYEONG: 30,
  
  /** 득지 (일지가 인성/비겁, 또는 12운성이 장생/관대/건록/제왕) */
  DEUKJI: 15,
  
  /** 득세 기본 점수 - 비겁+인성 vs 식상+재관 차이 */
  DEUKSE_BASE: 1, // 점수차 그대로 반영
} as const;


// ============================================
// 10. 용신 산출 관점별 가중치
// ============================================

/**
 * 5대 용신 관점별 가중치
 * - 최종 용신 점수 계산 시 적용
 */
export const YONGSIN_PERSPECTIVE_WEIGHTS = {
  /** 억부 용신 가중치 */
  EOKBU: 1.0,
  
  /** 조후 용신 가중치 (기본) */
  JOHU: 1.5,
  
  /** 격국 용신 가중치 */
  GYEOKGUK: 1.0,
  
  /** 통관 용신 가중치 */
  TONGGWAN: 1.3,
  
  /** 병약 용신 가중치 */
  BYEONGYAK: 1.0,
} as const;


// ============================================
// 타입 Export
// ============================================

export type OhaengType = 'wood' | 'fire' | 'earth' | 'metal' | 'water';

export type PositionType = 'YEAR' | 'MONTH' | 'DAY' | 'HOUR';
