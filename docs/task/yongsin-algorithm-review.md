# 용신 알고리즘 문서 검토 및 개발 계획

## 📅 작성일: 2025-12-16

## 📌 검토 대상 문서
1. **사주 용신 알고리즘.md** - 5대 용신 산출을 위한 통합 연산 모델 설계 보고서
2. **사주 용신수치화.md** - 5단계(Phase) 알고리즘 아키텍처

---

## 🎯 핵심 목표
사주 8글자를 입력받아 오행 수치화 → 신강/신약 판별 → 5대 용신 산출

---

## 📊 5대 용신 관점

| 관점 | 설명 | 우선순위 가중치 |
|------|------|----------------|
| **조후(調候)** | 온도/습도 맞추기 | 혹한/혹서 시 3.0x |
| **억부(抑扶)** | 신강 억제, 신약 부조 | 일반 1.5x |
| **격국(格局)** | 사회적 그릇, 직업 | 일반 1.5x |
| **통관(通關)** | 대립 오행 중재 | 충돌 시 2.0x |
| **병약(病藥)** | 병 제거 | 손상 시 1.3x |

---

## 📐 5단계 Phase 구조

### Phase 1: 오행 세력표 (Force Matrix)
- 1-1. 지장간 분해 (지지 → 오행 배분율)
- 1-2. 위치 가중치 (월지 3.0, 일지 1.5, 시지 1.2...)
- 1-3. 월령 사령 (절입일 기준)
- 1-4. 합(合) 처리 (천간합, 삼합, 방합, 육합)
- 1-5. 충(沖) 처리 (점수 삭감, 개고)

### Phase 2: 신강/신약 판별
- 득령(得令): 월지가 인성/비겁? +30점
- 득지(得地): 일지가 인성/비겁? +15점
- 득세(得勢): 비겁+인성 vs 식상+재관
- 통근 계수: 월지 1.5, 일지 1.3, 무근 0.7

**판정 기준:**
- +50 이상: 태왕 (종격 검토)
- +10~+49: 신강
- -10~+10: 중화
- -11~-40: 신약
- -41 이하: 태약 (종격 검토)

### Phase 3: 조후(Climate) 용신
- 자(子), 축(丑): 병화 필수 (Critical 3.0)
- 오(午): 임수 필수 (Critical 3.0)
- 미(未), 해(亥): High 2.0

### Phase 4: 다차원 용신 산출
- 4-1. 억부 용신 (신강→관살/식상, 신약→인성/비겁)
- 4-2. 통관 용신 (대립 오행 중재)
- 4-3. 병약 용신 (병 제거)
- 4-4. 격국 용신 (상신 - 순용/역용)

### Phase 5: 통합 최적 용신
```
FinalScore(E) = Score_억부 + (Score_조후 × 1.5) + Score_격국 + (Score_통관 × 1.3) + Score_병약
```

---

## 🔍 검토 의견

### ✅ 잘된 점
1. 체계적인 수치화 모델
2. 동적 상호작용 반영 (합/충)
3. 우선순위 로직 (조후 > 통관 > 억부)
4. 종격 예외 처리

### ⚠️ 보완 필요
1. 가중치 상수값 확정 필요 (2.5~3.0 → 정확한 값)
2. 합화 조건 세부 로직
3. 격국-억부 충돌 시 우선순위
4. 기존 코드와의 연동 (gyeokguk.ts, interactions.ts)

---

## 📅 개발 일정 (예상)

| Phase | 기간 | 의존성 |
|-------|------|--------|
| Phase 1 | 3-4일 | 기존 interactions.ts 활용 |
| Phase 2 | 2-3일 | Phase 1 필요 |
| Phase 3 | 1-2일 | 독립적 |
| Phase 4 | 3-4일 | Phase 1,2,3 필요 |
| Phase 5 | 2-3일 | Phase 4 필요 |
| **총계** | **11-16일** | |

---

## ❓ 개발 전 확정 필요

1. 가중치 상수값 확정
2. 합화 성립 조건 세부화
3. 우선순위 충돌 해결 로직
4. 출력 형식 (JSON 구조)

---

## 📁 기존 코드 연동 포인트

- `utils/gyeokguk.ts` - 격국 판단
- `utils/interactions.ts` - 합/충 처리
- `utils/manse.ts` - 만세력 계산
- `utils/geokguk-naegyeok.ts` - 내격 로직

---

작성자: Claude
버전: 1.0
